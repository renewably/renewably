import type { NextPage } from 'next';
import {
  QueryClient,
  QueryClientProvider,
  useQuery,
} from '@tanstack/react-query';
import Head from 'next/head';
import styles from '../styles/Home.module.css';
import { ProgramItem } from '../components/ProgramItem';
import { mockAPIResponse } from './api/mockData';
const getPrograms = async () => {
  try {
    const urlBase =
      'https://programs.dsireusa.org/api/v1/getprogramsbydate/20200101/20220101/json';
    const response = await fetch(urlBase, {
      mode: 'cors',
      credentials: 'include',
      headers: {
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'GET',
        'Access-Control-Allow-Headers': 'Content-Type',
        // 'Content-Type': 'application/json',
        // Vary: 'Origin',
      },
    });
    const data = await response.json();
    return data;
  } catch (error) {
    console.log('ut oh! NO data', { error });
  }
};

// export async function getServerSideProps() {
//   const programs = await getPrograms();
//   return { props: { programs } };
// }

const Programs: NextPage = () => {
  // const queryClient = new QueryClient();
  // const { data } = useQuery(['programs'], getPrograms, {
  //   // initialData: props.programs,
  //   initialData: [],
  // });
  const data = mockAPIResponse.data;
  getPrograms();

  return (
    // <QueryClientProvider client={queryClient}>
    <div className={styles.container}>
      <Head>
        <title>Programs</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>

      <main className={styles.main}>
        <h1 className={styles.title}>We should put filters/breadcrumbs here</h1>
        <ul>
          {data?.map((program: any) => (
            <ProgramItem program={program} />
          ))}
        </ul>
      </main>

      <footer className={styles.footer}></footer>
    </div>
    // </QueryClientProvider>
  );
};

export default Programs;
